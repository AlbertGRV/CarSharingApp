@{
    ViewData["Title"] = "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç";
    var user = ViewBag.User as ApplicationUser;
    var activeBookings = ViewBag.ActiveBookings as List<Booking>;
    var recentBookings = ViewBag.RecentBookings as List<Booking>;
    var totalBookings = (int)ViewBag.TotalBookings;
    var totalSpent = (decimal)ViewBag.TotalSpent;
}

<div class="container-fluid py-4">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="mb-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, @(user.FirstName ?? user.UserName)! üëã</h1>
                            <p class="mb-0 opacity-75">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –ø–æ–µ–∑–¥–∫–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–µ–º –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="text-white-50">
                                <small>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: @(user.LastLoginAt?.ToString("dd.MM.yyyy HH:mm") ?? "–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥")</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="display-4 text-primary mb-2">üöó</div>
                    <h3 class="text-primary">@activeBookings.Count</h3>
                    <p class="text-muted mb-0">–ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="display-4 text-success mb-2">üìä</div>
                    <h3 class="text-success">@totalBookings</h3>
                    <p class="text-muted mb-0">–í—Å–µ–≥–æ –ø–æ–µ–∑–¥–æ–∫</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="display-4 text-warning mb-2">üí∞</div>
                    <h3 class="text-warning">@totalSpent.ToString("N0") ‚ÇΩ</h3>
                    <p class="text-muted mb-0">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="display-4 text-info mb-2">‚≠ê</div>
                    <h3 class="text-info">4.8</h3>
                    <p class="text-muted mb-0">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="col-lg-8 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üöó –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                    <a asp-action="Bookings" class="btn btn-outline-primary btn-sm">–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                </div>
                <div class="card-body">
                    @if (activeBookings.Any())
                    {
                        @foreach (var booking in activeBookings)
                        {
                            <div class="d-flex align-items-center p-3 border rounded mb-3">
                                <div class="flex-shrink-0">
                                    <img src="@(booking.Car.ImageUrl ?? "/placeholder.svg?height=60&width=80")"
                                         alt="@booking.Car.Brand @booking.Car.Model"
                                         class="rounded" style="width: 80px; height: 60px; object-fit: cover;">
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-1">@booking.Car.Brand @booking.Car.Model</h6>
                                    <p class="text-muted mb-1">@booking.Car.Color, @booking.Car.Year –≥–æ–¥</p>
                                    <small class="text-muted">
                                        üìç @booking.Car.Address
                                    </small>
                                </div>
                                <div class="text-end">
                                    <div class="mb-1">
                                        <strong>@booking.StartTime?.ToString("dd.MM HH:mm")</strong>
                                    </div>
                                    <div class="text-muted">
                                        –¥–æ @booking.EndTime?.ToString("dd.MM HH:mm")
                                    </div>
                                    <div class="mt-2">
                                        <a asp-action="BookingDetails" asp-route-id="@booking.Id"
                                           class="btn btn-primary btn-sm">–î–µ—Ç–∞–ª–∏</a>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <div class="display-1 text-muted mb-3">üöó</div>
                            <h5 class="text-muted">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h5>
                            <p class="text-muted">–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
                            <a asp-action="QuickBooking" class="btn btn-primary">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-lg-4">
            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="QuickBooking" class="btn btn-primary">
                            <i class="me-2">üöó</i>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å
                        </a>
                        <a asp-action="Bookings" class="btn btn-outline-secondary">
                            <i class="me-2">üìã</i>–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                        </a>
                        <a asp-action="Profile" class="btn btn-outline-secondary">
                            <i class="me-2">üë§</i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                        </a>
                        <a asp-action="Notifications" class="btn btn-outline-secondary">
                            <i class="me-2">üîî</i>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        </a>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center"
                             style="width: 60px; height: 60px;">
                            <span class="text-white fs-4">@((user.FirstName ?? user.UserName).Substring(0, 1).ToUpper())</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <h6>@(user.FirstName + " " + user.LastName)</h6>
                        <p class="text-muted small">@user.Email</p>
                        @if (!string.IsNullOrEmpty(user.PhoneNumber))
                        {
                            <p class="text-muted small">üìû @user.PhoneNumber</p>
                        }
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            –ß–ª–µ–Ω CarShare —Å @user.CreatedAt.ToString("MMMM yyyy")
                        </small>
                    </div>
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏ -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0">üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏</h5>
                </div>
                <div class="card-body">
                    @if (recentBookings.Any())
                    {
                        @foreach (var booking in recentBookings.Take(3))
                        {
                            <div class="d-flex align-items-center mb-3">
                                <div class="flex-shrink-0">
                                    <div class="bg-light rounded p-2">
                                        <small>üöó</small>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0 small">@booking.Car.Brand @booking.Car.Model</h6>
                                    <small class="text-muted">@booking.CreatedAt.ToString("dd.MM.yyyy")</small>
                                </div>
                                <div class="text-end">
                                    <small class="text-success fw-bold">@booking.TotalCost ‚ÇΩ</small>
                                </div>
                            </div>
                        }
                        <div class="text-center mt-3">
                            <a asp-action="Bookings" class="btn btn-outline-primary btn-sm">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            <small>–ü–æ–µ–∑–¥–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</small>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .card {
        transition: transform 0.2s ease-in-out;
    }

        .card:hover {
            transform: translateY(-2px);
        }

    .border-0 {
        border: none !important;
    }

    .shadow-sm {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
    }
</style>